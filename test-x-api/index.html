<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Airtable Integration Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #18021A;
      color: #fff;
      font-family: system-ui, -apple-system, sans-serif;
      padding: 40px 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    h1 {
      font-size: 32px;
      font-weight: 300;
      margin-bottom: 12px;
      background: linear-gradient(135deg, #AC0064, #64109A);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: rgba(255, 255, 255, 0.5);
      font-size: 14px;
      margin-bottom: 40px;
    }

    .form-group {
      margin-bottom: 24px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
    }

    input, textarea {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
      font-family: monospace;
      transition: all 0.2s;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: #AC0064;
      background: rgba(255, 255, 255, 0.08);
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .btn {
      background: linear-gradient(135deg, #AC0064, #64109A);
      color: #fff;
      border: none;
      padding: 14px 32px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: transform 0.2s, opacity 0.2s;
      margin-top: 8px;
    }

    .btn:hover {
      transform: translateY(-2px);
      opacity: 0.9;
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .results {
      margin-top: 40px;
      padding: 24px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      display: none;
    }

    .results.show {
      display: block;
    }

    .results h2 {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 16px;
      color: #AC0064;
    }

    .creator-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }

    .creator-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 16px;
      transition: all 0.2s;
    }

    .creator-card:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: #AC0064;
    }

    .creator-handle {
      font-size: 16px;
      font-weight: 500;
      color: #fff;
      margin-bottom: 4px;
    }

    .creator-email {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      word-break: break-all;
    }

    .creator-phone {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      margin-top: 4px;
    }

    .loading {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: #AC0064;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-left: 8px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error {
      background: rgba(224, 0, 0, 0.1);
      border: 1px solid rgba(224, 0, 0, 0.3);
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
      color: #ff6b6b;
      font-size: 14px;
    }

    .success {
      background: rgba(0, 224, 0, 0.1);
      border: 1px solid rgba(0, 224, 0, 0.3);
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
      color: #6bff6b;
      font-size: 14px;
    }

    pre {
      background: rgba(0, 0, 0, 0.3);
      padding: 16px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 12px;
      margin-top: 12px;
    }

    .stats {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .stat {
      background: rgba(172, 0, 100, 0.1);
      border: 1px solid rgba(172, 0, 100, 0.3);
      border-radius: 8px;
      padding: 12px 20px;
    }

    .stat-label {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 600;
      color: #AC0064;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Airtable Integration Test</h1>
    <p class="subtitle">Verify Airtable connection and fetch creator handles</p>

    <div class="form-group">
      <label for="apiKey">Airtable API Key (Personal Access Token)</label>
      <input 
        type="password" 
        id="apiKey" 
        placeholder="patp3YH0tUQ1hKuNL..." 
      />
      <small style="display: block; margin-top: 4px; color: rgba(255,255,255,0.4); font-size: 12px;">
        Get from: investor_site/.env.production (AIRTABLE_API_KEY)
      </small>
    </div>

    <div class="form-group">
      <label for="baseId">Base ID</label>
      <input 
        type="text" 
        id="baseId" 
        placeholder="appv5KPKpVtQm3MbE" 
      />
      <small style="display: block; margin-top: 4px; color: rgba(255,255,255,0.4); font-size: 12px;">
        Get from: investor_site/.env.production (AIRTABLE_BASE_ID)
      </small>
    </div>

    <div class="form-group">
      <label for="tableId">Creators Table ID</label>
      <input 
        type="text" 
        id="tableId" 
        placeholder="tblTYUu6019qDOoSQ" 
      />
      <small style="display: block; margin-top: 4px; color: rgba(255,255,255,0.4); font-size: 12px;">
        Get from: investor_site/.env.production (AIRTABLE_CREATORS_TABLE)
      </small>
    </div>

    <button class="btn" onclick="fetchCreators()">
      Fetch Creators
      <span id="loading" class="loading" style="display: none;"></span>
    </button>

    <div id="results" class="results">
      <div class="stats">
        <div class="stat">
          <div class="stat-label">Total Creators</div>
          <div class="stat-value" id="totalCount">0</div>
        </div>
        <div class="stat">
          <div class="stat-label">With X Handle</div>
          <div class="stat-value" id="xHandleCount">0</div>
        </div>
        <div class="stat">
          <div class="stat-label">With Email</div>
          <div class="stat-value" id="emailCount">0</div>
        </div>
      </div>

      <h2>Creator Records</h2>
      <div id="creatorList" class="creator-list"></div>

      <details style="margin-top: 20px;">
        <summary style="cursor: pointer; color: rgba(255,255,255,0.7); font-size: 14px; margin-bottom: 12px;">
          View Raw JSON Response
        </summary>
        <pre id="rawJson"></pre>
      </details>
    </div>
  </div>

  <script>
    async function fetchCreators() {
      const apiKey = document.getElementById('apiKey').value.trim();
      const baseId = document.getElementById('baseId').value.trim();
      const tableId = document.getElementById('tableId').value.trim();
      
      const btn = document.querySelector('.btn');
      const loading = document.getElementById('loading');
      const results = document.getElementById('results');
      const creatorList = document.getElementById('creatorList');
      const rawJson = document.getElementById('rawJson');

      if (!apiKey || !baseId || !tableId) {
        alert('Please fill in all fields');
        return;
      }

      // Clear previous results
      creatorList.innerHTML = '';
      rawJson.textContent = '';
      results.classList.remove('show');
      
      // Show loading
      btn.disabled = true;
      loading.style.display = 'inline-block';

      try {
        const response = await fetch(`http://localhost:8787/airtable?baseId=${baseId}&tableId=${tableId}`, {
          headers: {
            'Authorization': `Bearer ${apiKey}`
          }
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || `HTTP ${response.status}`);
        }

        // Display raw JSON
        rawJson.textContent = JSON.stringify(data, null, 2);

        // Count stats
        const records = data.records || [];
        const xHandleCount = records.filter(r => r.fields['X.com']).length;
        const emailCount = records.filter(r => r.fields['Emails']).length;

        document.getElementById('totalCount').textContent = records.length;
        document.getElementById('xHandleCount').textContent = xHandleCount;
        document.getElementById('emailCount').textContent = emailCount;

        // Display creators
        if (records.length === 0) {
          creatorList.innerHTML = '<div class="error">No creators found in Airtable</div>';
        } else {
          records.forEach(record => {
            const card = document.createElement('div');
            card.className = 'creator-card';
            
            const handle = record.fields['X.com'] || 'No X handle';
            const email = record.fields['Emails'] || '';
            const phone = record.fields['Phone number'] || '';
            
            card.innerHTML = `
              <div class="creator-handle">${escapeHtml(handle)}</div>
              ${email ? `<div class="creator-email">${escapeHtml(email)}</div>` : ''}
              ${phone ? `<div class="creator-phone">${escapeHtml(phone)}</div>` : ''}
            `;
            
            creatorList.appendChild(card);
          });
        }

        results.classList.add('show');

      } catch (error) {
        console.error('Fetch error:', error);
        creatorList.innerHTML = `<div class="error">
          <strong>Error:</strong> ${escapeHtml(error.message)}
        </div>`;
        results.classList.add('show');
      } finally {
        btn.disabled = false;
        loading.style.display = 'none';
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Allow Enter key to submit
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && e.target.tagName === 'INPUT') {
        fetchCreators();
      }
    });
  </script>
</body>
</html>
